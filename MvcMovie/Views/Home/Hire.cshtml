@{
    ViewData["Title"] = "Wydanie";
}

<style>
    h1, 
    .form-section {
        padding: 20px;
        border-bottom: 1px solid gray;
    }

    .person-name {
        font-size: 20px;
    }

    .dx-textbox {
        display: inline-block;
    }

    .person-validation {
        color: red;
        font-size: 12px;
    }
</style>

<h1>Wydanie</h1>

<div class="form-section">
    <h2>Wprowadź osobę odbierającą</h2>
    <form id="person-form">
        <p class="person-validation"></p>
        @(Html.DevExtreme().TextBox()
            .Label("Identyfikator osoby")
            .LabelMode(EditorLabelMode.Floating)
            .Name("person-searching-text")
            .Width(300)
        )
        <button class="inline" type="submit" id="add-person">Dodaj</button>
    </form>
    <p class="person-name">*** ********</p>
    <input type="hidden" id="person-id"/>
</div>

<div class="form-section">
    <h2>Wprowadź obiekty</h2>
    <form id="assets-form">
        @(Html.DevExtreme().TextBox()
            .Label("Identyfikator obiektu")
            .LabelMode(EditorLabelMode.Floating)
            .Width(300)
        )
        <button class="inline" type="submit">+ Dodaj</button>
    </form>
    @(Html.DevExtreme().DataGrid<Organization>()
        .Columns(columns =>
        {
            columns.AddFor(m => m.Id);
            columns.AddFor(m => m.Code);
            columns.AddFor(m => m.Name);
        })
        .DataSource(new List<Organization>())
        .Editing(e => e
            .Mode(GridEditMode.Row)
            .AllowUpdating(false)
            .AllowAdding(false)
            .AllowDeleting(true)
        )
        .ID("assets-grid")
    )
</div>


<script>
    class HireModel {
        constructor(personId, assetIds) {
            this.personId = personId,
            this.assetIds = assetIds
        }
    }

    const personForm = document.querySelector("form#person-form");
    personForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const personFormData = new FormData(personForm);
        const personSearchingText = personFormData.get("person-searching-text");
        const response = await fetch("@Url.Action("GetPersonBySearchingText", "Person")" + `?searchingText=${personSearchingText}`);
        
        if (response.ok) {
            const data = await response.json();

            const personIdInput = document.querySelector("input#person-id");
            personIdInput.value = data.Id;

            const personData = document.querySelector(".person-name");
            personData.textContent = data.FirstName;

            const addPersonButton = document.querySelector("button#add-person");
            addPersonButton.textContent = "Zmień";
        } else {
            const personValidationDOM = document.querySelector(".person-validation");
            personValidationDOM.textContent = "Nie znaleziono osoby";
        }
    });
    
</script>